<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ok-admin v1.0 | 很赞的后台模版</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../css/okadmin.css">
</head>
<body>
<div class="ok-body">
    <blockquote class="layui-elem-quote">
        欢迎管理员：<span class="x-red" id="username"></span>！当前时间: <span id="nowTime"></span> <span id="weekday"></span>
    </blockquote>
    <fieldset class="layui-elem-field">
        <legend>数据统计</legend>
        <div class="layui-row layui-col-space10 layui-row-margin">
            <div class="layui-col-md2">
                <div class="layui-bg-red md2-sub1">
                    <i class="iconfont icon-jiaoseguanli"></i>
                </div>
                <div class="md2-sub2">
                    <span id="roleCount">0</span>
                    <cite>角色总数</cite>
                </div>
            </div>
            <div class="layui-col-md2">
                <div class="layui-bg-green md2-sub1">
                    <i class="iconfont icon-dianliyonghuzongshu"></i>
                </div>
                <div class="md2-sub2">
                    <span id="userCount">0</span>
                    <cite>用户总数</cite>
                </div>
            </div>
            <div class="layui-col-md2">
                <div class="layui-bg-orange md2-sub1">
                    <i class="iconfont icon-goods"></i>
                </div>
                <div class="md2-sub2">
                    <span id="productCount">0</span>
                    <cite>商品总数</cite>
                </div>
            </div>
            <div class="layui-col-md2">
                <div class="layui-bg-black md2-sub1">
                    <i class="iconfont icon-pinglun"></i>
                </div>
                <div class="md2-sub2">
                    <span id="reviewCount">0</span>
                    <cite>评论总数</cite>
                </div>
            </div>
            <div class="layui-col-md2">
                <div class="layui-bg-orange md2-sub1">
                    <i class="iconfont icon-huanxingtu"></i>
                </div>
                <div class="md2-sub2">
                    <span id="unFinishCount">0</span>
                    <cite>未完成订单</cite>
                </div>
            </div>
            <div class="layui-col-md2">
                <div class="layui-bg-green md2-sub1">
                    <i class="iconfont icon-caidan"></i>
                </div>
                <div class="md2-sub2">
                    <span id="finishCount">0</span>
                    <cite>已完成订单</cite>
                </div>
            </div>
        </div>
    </fieldset>
    <div id="main" style="width: 100%;height:400px;margin-top: 50px;"></div>
    <div class="layui-form layui-border-box layui-table-view" style="border-style: none">
        <div class="layui-table-tool" style="background-color: #ffffff;border-style: none">
            <button class="layui-btn layui-btn-sm layui-btn-primary" id="day">最近七天</button>
            <button class="layui-btn layui-btn-sm layui-btn-primary" id="month">最近一个月</button>
            <button class="layui-btn layui-btn-sm layui-btn-primary" id="year">最近一年</button>
        </div>
    </div>
    <blockquote class="layui-elem-quote">
        作者信息
    </blockquote>
    <table class="layui-table">
        <colgroup>
            <col width="300">
            <col>
        </colgroup>
        <tbody>
        <tr>
            <td>开发者</td>
            <td>Ming - <a href="mailto:helloworld2019@dingtalk.com">helloworld2019@dingtalk.com</a></td>
        </tr>
        <tr>
            <td>下载地址1</td>
            <td>
                目前正在不间断迭代开发中，请大家多多
                <a class="layui-btn layui-btn-danger layui-btn-xs" href="https://github.com/943013457/shopping"
                   target="_blank">Star</a>
                ，您的鼓励就是我开发的动力，O(∩_∩)O谢谢~
            </td>
        </tr>
        </tbody>
    </table>

    <blockquote class="layui-elem-quote">
        更新日志
    </blockquote>
    <ul class="layui-timeline">
        <li class="layui-timeline-item">
            <i class="layui-icon layui-timeline-axis">&#xe756;</i>
            <div class="layui-timeline-content layui-text">
                <h3 class="layui-timeline-title">6月15日</h3>
                <p>
                    ok-admin大体架构成型。
                    <br>不枉近半个月日日夜夜与之为伴。
                    <br>无论它能走多远，抑或如何支撑？至少我曾倾注全心，无怨无悔 <i class="layui-icon">&#xe6af;</i>
                </p>
            </div>
        </li>
        <li class="layui-timeline-item">
            <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
            <div class="layui-timeline-content layui-text">
                <h3 class="layui-timeline-title">5月13日</h3>
                <p>毕业答辩结束，至此感觉<em>大学，就这样结束了。</em>送两句话给自己：</p>
                <ul>
                    <li>但行好事 莫问前程</li>
                    <li>纵有疾风起 人生不言弃</li>
                </ul>
            </div>
        </li>
        <li class="layui-timeline-item">
            <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
            <div class="layui-timeline-content layui-text">
                <h3 class="layui-timeline-title">5月4日</h3>
                <p>
                    正在准备毕业答辩
                    <br>常常在想，要是有一个满足我项目所有基础页面的CMS该多好
                    <br>今天，初始化项目
                </p>
            </div>
        </li>
        <li class="layui-timeline-item">
            <i class="layui-icon layui-timeline-axis layui-anim layui-anim-rotate layui-anim-loop">&#xe63e;</i>
            <div class="layui-timeline-content layui-text">
                <div class="layui-timeline-title">过去</div>
            </div>
        </li>
    </ul>
</div>
<!--js引入-->
<script src="../lib/layui/layui.js"></script>
<!--js逻辑-->
<script type="text/javascript" src="/js/ref/jQuery_v1.12.4_min.js"></script>
<script type="text/javascript" src="/js/ref/toastr.min.js"></script>
<script type="text/javascript" src="/js/tool/init.js"></script>
<script src="/html/admin/lib/echarts/echarts.common.min.js"></script>
<script type="text/javascript">
    $(function () {
        $("#day").click(function () {
            showEcharts(-7);
        })
        $("#month").click(function () {
            showEcharts(-30);
        })
        $("#year").click(function () {
            showEcharts(-365);
        })
        FastTools.ajax("/getIndexCount", "GET", "", function (flag, data) {
            if (flag) {
                let json = data.msg;
                $("#roleCount").html(json.roleCount);
                $("#userCount").html(json.userCount);
                $("#productCount").html(json.productCount);
                $("#reviewCount").html(json.reviewCount);
                $("#unFinishCount").html(json.unFinishCount);
                $("#finishCount").html(json.finishCount);
            }
        });
        $("#username").html(FastTools.getUserName());
    });

    layui.use("util", function () {
        var util = layui.util;
        util.fixbar({});
    });

    /**
     * 初始化函数
     */
    setDate();

    /**
     * 获取当前时间
     */
    var nowDate1 = "";

    function setDate() {
        var date = new Date();
        var year = date.getFullYear();
        nowDate1 = year + "-" + addZero((date.getMonth() + 1)) + "-" + addZero(date.getDate()) + "  ";
        nowDate1 += addZero(date.getHours()) + ":" + addZero(date.getMinutes()) + ":" + addZero(date.getSeconds());
        document.getElementById("nowTime").innerHTML = nowDate1;
        setTimeout('setDate()', 1000);
    }

    /**
     * 年月日是分秒为10以下的数字则添加0字符串
     * @param time
     * @returns {number | *}
     */
    function addZero(time) {
        var i = parseInt(time);
        if (i / 10 < 1) {
            i = "0" + i;
        }
        return i;
    }

    /**
     * 初始化星期几
     * @type {string}
     */
    var weekday = "星期" + "日一二三四五六".charAt(new Date().getDay());
    document.getElementById("weekday").innerHTML = weekday;

    // 基于准备好的dom，初始化echarts实例
    showEcharts(-7);

    function showEcharts(showTime) {
        $.getJSON('/html/admin/lib/echarts/macarons.json', function (macaronsJSON) {
            echarts.registerTheme('macarons', macaronsJSON)
            var myChart = echarts.init(document.getElementById("main"), 'macarons');
            $.getJSON('/getPayLog', {time: showTime}, function (retJson) {
                let msg = retJson.msg;
                let xAxis = [];//x轴
                let legend = [];
                let series = [];
                let yMax = 0;
                for (let titleName in msg) {
                    legend.push(titleName);
                    series.push({
                        name: titleName,
                        type: 'line',
                        stack: '总量',
                        areaStyle: {},
                        data: []
                    })
                }
                for (let i = showTime; i <= 0; i++) {
                    let date = new Date();
                    date.setDate(new Date().getDate() + i);
                    let year = date.getFullYear();
                    let month = ("0" + (date.getMonth() + 1)).slice(-2);
                    let day = ("0" + date.getDate()).slice(-2);
                    xAxis.push(month + "-" + day);
                    for (let index in legend) {
                        let titleName = legend[index];
                        let p = year + "-" + month + "-" + day;
                        if (msg[titleName].hasOwnProperty(p)) {
                            let value = msg[titleName][p];
                            series[index].data.push(value);
                            if (value > yMax) {
                                yMax = value;
                            }
                        } else {
                            series[index].data.push(0);
                        }
                    }
                }

                // 指定图表的配置项和数据
                var option = {
                    title: {
                        text: '交易订单统计'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#6a7985'
                            }
                        }
                    },
                    legend: {
                        data: legend
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: [
                        {
                            type: 'category',
                            boundaryGap: false,
                            data: xAxis
                        }
                    ],
                    yAxis: [
                        {
                            minInterval: 1,
                            type: 'value',
                            max: yMax * 1.5
                        }
                    ],
                    series: series
                };
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            });
        });
    }
</script>
</body>
</html>
